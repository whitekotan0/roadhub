<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RoadMaths - Static Math Roadmap</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #0a0a0a;
      color: #fff;
      overflow: hidden;
    }
    
    #container {
      width: 100vw;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    #toolbar {
      background: #1a1a1a;
      padding: 12px 20px;
      border-bottom: 1px solid #333;
      display: flex;
      gap: 12px;
      align-items: center;
    }
    
    #toolbar h1 {
      font-size: 20px;
      margin-right: auto;
    }
    
    button {
      background: #2a2a2a;
      border: 1px solid #444;
      color: #fff;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }
    
    button:hover {
      background: #3a3a3a;
      border-color: #666;
    }
    
    #canvas-wrapper {
      flex: 1;
      overflow: auto;
      position: relative;
    }
    
    svg {
      background: #0a0a0a;
      display: block;
    }
    
    .node rect {
      fill: #1e293b;
      stroke: #334155;
      stroke-width: 2;
      rx: 8;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .node:hover rect {
      fill: #2d3e56;
      stroke: #4a5f7f;
    }
    
    .node.completed rect {
      fill: #065f46;
      stroke: #10b981;
    }
    
    .node text {
      fill: white;
      font-size: 14px;
      font-weight: 500;
      pointer-events: none;
      user-select: none;
    }
    
    .link {
      stroke: #475569;
      stroke-width: 2;
      fill: none;
      marker-end: url(#arrow);
    }
    
    .arrow {
      fill: #475569;
    }
    
    #info {
      position: fixed;
      top: 70px;
      right: 20px;
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 16px;
      max-width: 300px;
      display: none;
    }
    
    #info.active {
      display: block;
    }
    
    #info h3 {
      margin-bottom: 8px;
      font-size: 18px;
    }
    
    #info p {
      color: #999;
      font-size: 14px;
      line-height: 1.5;
      margin-bottom: 12px;
    }
    
    #info a {
      color: #60a5fa;
      text-decoration: none;
    }

    .level-label {
      fill: #666;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="toolbar">
      <h1>üó∫Ô∏è RoadMaths</h1>
      <button onclick="exportJSON()">Export JSON</button>
      <button onclick="clearProgress()">Clear Progress</button>
    </div>
    <div id="canvas-wrapper">
      <svg id="canvas"></svg>
    </div>
  </div>
  
  <div id="info">
    <h3 id="info-title"></h3>
    <p id="info-desc"></p>
    <div id="info-links"></div>
    <button onclick="closeInfo()">Close</button>
  </div>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
    // ===== STATIC JSON DATA =====
    const roadmapData = {
      "meta": {
        "title": "roadmaths",
        "version": "0.1",
        "author": "whitekotan"
      },
      "nodes": [
        // LEVEL 0: BASICS
        {
          "id": "arithmetic",
          "label": "Arithmetic",
          "level": 0,
          "position": { "x": 100, "y": 100 },
          "width": 160,
          "height": 60,
          "content": {
            "description": "Basic operations: +, -, √ó, √∑",
            "links": ["https://khanacademy.org/math/arithmetic"]
          }
        },
        {
          "id": "fractions",
          "label": "Fractions",
          "level": 0,
          "position": { "x": 100, "y": 200 },
          "width": 160,
          "height": 60,
          "content": {
            "description": "Understanding fractions and operations",
            "links": ["https://khanacademy.org/math/fractions"]
          }
        },
        {
          "id": "decimals",
          "label": "Decimals",
          "level": 0,
          "position": { "x": 100, "y": 300 },
          "width": 160,
          "height": 60,
          "content": {
            "description": "Decimal numbers and operations",
            "links": []
          }
        },

        // LEVEL 1: HIGH SCHOOL
        {
          "id": "algebra-basics",
          "label": "Basic Algebra",
          "level": 1,
          "position": { "x": 350, "y": 150 },
          "width": 160,
          "height": 60,
          "content": {
            "description": "Variables, expressions, linear equations",
            "links": ["https://khanacademy.org/math/algebra"]
          }
        },
        {
          "id": "geometry",
          "label": "Geometry",
          "level": 1,
          "position": { "x": 350, "y": 250 },
          "width": 160,
          "height": 60,
          "content": {
            "description": "Shapes, angles, area, perimeter",
            "links": ["https://khanacademy.org/math/geometry"]
          }
        },

        // LEVEL 2: ADVANCED HIGH SCHOOL
        {
          "id": "functions",
          "label": "Functions",
          "level": 2,
          "position": { "x": 600, "y": 100 },
          "width": 160,
          "height": 60,
          "content": {
            "description": "Function notation, domain, range",
            "links": []
          }
        },
        {
          "id": "quadratic",
          "label": "Quadratic Equations",
          "level": 2,
          "position": { "x": 600, "y": 200 },
          "width": 180,
          "height": 60,
          "content": {
            "description": "ax¬≤ + bx + c = 0, discriminant, Vieta",
            "links": ["https://brilliant.org/quadratic"]
          }
        },
        {
          "id": "trigonometry",
          "label": "Trigonometry",
          "level": 2,
          "position": { "x": 600, "y": 300 },
          "width": 160,
          "height": 60,
          "content": {
            "description": "Sin, cos, tan, trigonometric identities",
            "links": []
          }
        },

        // LEVEL 3: BACHELOR
        {
          "id": "calculus-1",
          "label": "Calculus I",
          "level": 3,
          "position": { "x": 850, "y": 150 },
          "width": 160,
          "height": 60,
          "content": {
            "description": "Limits, derivatives, basic integration",
            "links": ["https://ocw.mit.edu/calculus"]
          }
        },
        {
          "id": "linear-algebra",
          "label": "Linear Algebra",
          "level": 3,
          "position": { "x": 850, "y": 250 },
          "width": 160,
          "height": 60,
          "content": {
            "description": "Matrices, vectors, linear transformations",
            "links": []
          }
        }
      ],
      "edges": [
        // Level 0 ‚Üí 1
        { "from": "arithmetic", "to": "algebra-basics" },
        { "from": "fractions", "to": "algebra-basics" },
        { "from": "arithmetic", "to": "geometry" },
        { "from": "decimals", "to": "algebra-basics" },

        // Level 1 ‚Üí 2
        { "from": "algebra-basics", "to": "functions" },
        { "from": "algebra-basics", "to": "quadratic" },
        { "from": "geometry", "to": "trigonometry" },

        // Level 2 ‚Üí 3
        { "from": "functions", "to": "calculus-1" },
        { "from": "quadratic", "to": "calculus-1" },
        { "from": "trigonometry", "to": "calculus-1" },
        { "from": "algebra-basics", "to": "linear-algebra" }
      ]
    };

    // ===== LOAD PROGRESS FROM LOCALSTORAGE =====
    const progress = JSON.parse(localStorage.getItem('roadmaths-progress') || '{}');

    // ===== SETUP SVG =====
    const svg = d3.select("#canvas");
    const nodes = roadmapData.nodes;
    const edges = roadmapData.edges;

    // Calculate canvas size
    const maxX = Math.max(...nodes.map(n => n.position.x + n.width)) + 100;
    const maxY = Math.max(...nodes.map(n => n.position.y + n.height)) + 100;
    svg.attr("width", maxX).attr("height", maxY);

    // ===== ARROW MARKER =====
    svg.append("defs")
      .append("marker")
      .attr("id", "arrow")
      .attr("markerWidth", 10)
      .attr("markerHeight", 10)
      .attr("refX", 9)
      .attr("refY", 3)
      .attr("orient", "auto")
      .append("path")
      .attr("d", "M0,0 L0,6 L9,3 z")
      .attr("class", "arrow");

    // ===== HELPER: ORTHOGONAL PATH (90 DEGREES) =====
    function getOrthogonalPath(fromNode, toNode) {
      const x1 = fromNode.position.x + fromNode.width;  // Right edge of source
      const y1 = fromNode.position.y + fromNode.height / 2;
      
      const x2 = toNode.position.x;  // Left edge of target
      const y2 = toNode.position.y + toNode.height / 2;

      const arrowOffset = 2;
      
      // Mid point for the turn
      const midX = (x1 + x2) / 2;
      
      // Orthogonal path: horizontal ‚Üí vertical ‚Üí horizontal
      return `M${x1},${y1} L${midX},${y1} L${midX},${y2} L${x2 - arrowOffset},${y2}`;
    }

    // ===== DRAW EDGES =====
    const nodeMap = new Map(nodes.map(n => [n.id, n]));

    svg.selectAll(".link")
      .data(edges)
      .enter()
      .append("path")
      .attr("class", "link")
      .attr("d", d => {
        const from = nodeMap.get(d.from);
        const to = nodeMap.get(d.to);
        if (!from || !to) return "";
        return getOrthogonalPath(from, to);
      });

    // ===== DRAW NODES =====
    const node = svg.selectAll(".node")
      .data(nodes)
      .enter()
      .append("g")
      .attr("class", d => `node ${progress[d.id] ? 'completed' : ''}`)
      .attr("transform", d => `translate(${d.position.x}, ${d.position.y})`);

    node.append("rect")
      .attr("width", d => d.width)
      .attr("height", d => d.height);

    node.append("text")
      .attr("x", d => d.width / 2)
      .attr("y", d => d.height / 2)
      .attr("text-anchor", "middle")
      .attr("dy", "0.35em")
      .text(d => d.label);

    // ===== NODE CLICK =====
    node.on("click", (event, d) => {
      // Toggle completion
      progress[d.id] = !progress[d.id];
      localStorage.setItem('roadmaths-progress', JSON.stringify(progress));
      
      d3.select(event.currentTarget)
        .classed("completed", progress[d.id]);

      // Show info
      showInfo(d);
    });

    // ===== HELPER FUNCTIONS =====
    function showInfo(node) {
      const info = document.getElementById("info");
      document.getElementById("info-title").textContent = node.label;
      document.getElementById("info-desc").textContent = node.content.description;
      
      const linksDiv = document.getElementById("info-links");
      linksDiv.innerHTML = node.content.links.length > 0
        ? node.content.links.map(link => `<a href="${link}" target="_blank">üìö Learn more</a><br>`).join('')
        : '<p style="color: #666">No resources yet</p>';
      
      info.classList.add("active");
    }

    function closeInfo() {
      document.getElementById("info").classList.remove("active");
    }

    function exportJSON() {
      const exportData = {
        ...roadmapData,
        nodes: nodes.map(n => ({
          ...n,
          completed: !!progress[n.id]
        }))
      };
      
      const blob = new Blob([JSON.stringify(exportData, null, 2)], 
        { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'roadmap.json';
      a.click();
    }

    function clearProgress() {
      if (confirm('Clear all progress?')) {
        localStorage.removeItem('roadmaths-progress');
        location.reload();
      }
    }

    // Click outside to close info
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.node') && !e.target.closest('#info')) {
        closeInfo();
      }
    });
  </script>
</body>
</html>